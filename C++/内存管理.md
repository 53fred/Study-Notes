# 内存管理
## C++内存分区
- **栈区：**由**编译器自动分配与释放**，存放为运行时函数分配的局部变量、函数参数、返回数据、返回地址等。
- **堆区：**动态申请的内存空间，由 malloc 分配的内存块，由**程序员**控制它的分配和释放，如果程序执行结束还没有释放，操作系统会自动回收。其分配类似于链表。
- **全局区/静态存储区（.bss 段和 .data 段）：**  存放全局变量和静态变量（作用域是局部的，但生命期是全局的），程序运行结束操作系统自动释放，**未初始化或初始化为0**的放在 .bss 段中，其余初始化的放在 .data 段中。
- **常量存储区（.rodata段）：** 存放的是常量（const修饰的除局部非静态外所有变量），不允许修改，程序运行结束自动释放。.rodata段在多个进程间是共享的。
- **代码区（.text 段）：** 存放代码，不允许修改，但可以执行。编译后的二进制文件存放在这里。

从操作系统的本身来讲，以上存储区在内存中的分布是如下形式(从低地址到高地址)：.text 段 --> .data 段 --> .bss 段 --> 堆 --> unused（共享区） --> 栈 --> env（命令行参数与环境变量）
## 内存分配方式
- **静态存储区分配：** 内存在程序编译的时候已经分配好，这块内存在程序的整个运行期间都存在。例如全局变量，static变量。
- **在栈上创建：** 在执行函数时，函数内局部变量的存储单元可以在栈上创建，函数执行结束时，这些内存单元会自动被释放。栈内存分配运算内置于处理器的指令集，效率高，但是分配的内存容量有限。
- **从堆上分配：** 亦称为动态内存分配。程序在运行的时候使用malloc或者new申请任意多少的内存，程序员自己负责在何时用free或delete释放内存。动态内存的生命周期有程序员决定，使用非常灵活，但如果在堆上分配了空间，既有责任回收它，否则运行的程序会出现内存泄漏，频繁的分配和释放不同大小的堆空间将会产生内存碎片。

## 栈和堆的区别
- **申请后系统响应：** 分配栈空间：如果剩余空间大于申请空间则分配成功，否则分配失败栈溢出；  
申请堆空间：堆在内存中呈现的方式类似于链表（记录空闲地址空间的链表），在链表上寻找第一个大于申请空间的节点分配给程序，将该节点从链表中删除，大多数系统中该块空间的首地址存放的是本次分配空间的大小，便于释放，将该块空间上的剩余空间再次连接在空闲链表上。
- 栈在内存中是**连续的一块空间（向低地址扩展）**最大容量是系统预定好的，堆在内存中的**空间（向高地址扩展）是不连续的**。
- 申请效率：栈是有系统自动分配，申请效率高，但程序员无法控制；堆是由程序员主动申请，效率低，使用起来方便但是容易产生碎片。
